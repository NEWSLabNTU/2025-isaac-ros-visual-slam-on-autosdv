<?xml version="1.0"?>
<launch>
  <!-- Launch arguments -->
  <arg name="base_frame" default="zedxm_camera_center" description="Base frame for odometry"/>
  <arg name="camera_optical_frames" default="['zedxm_left_camera_frame_optical', 'zedxm_right_camera_frame_optical']" description="List of camera optical frames"/>
  <arg name="start_rviz" default="false" description="Start RViz for visualization"/>
  <arg name="camera_name" default="zedxm" description="Camera name for namespacing"/>

  <!-- Launch ZED X Mini camera node -->
  <include file="$(find-pkg-share zed_wrapper)/launch/zed_camera.launch.py">
    <arg name="camera_model" value="zedxm"/>
    <arg name="camera_name" value="$(var camera_name)"/>
    <arg name="enable_ipc" value="false"/>
    <arg name="ros_params_override_path" value="$(find-pkg-share slam_launch)/config/zedxm.yaml"/>
  </include>

  <!-- Container with composable nodes -->
  <node_container pkg="rclcpp_components" exec="component_container" name="visual_slam_launch_container" namespace="">

    <!-- Visual SLAM node - Direct NITROS connection to ZED camera -->
    <composable_node pkg="isaac_ros_visual_slam" plugin="nvidia::isaac_ros::visual_slam::VisualSlamNode" name="visual_slam_node">
      <param name="rectified_images" value="True"/>
      <param name="enable_slam_visualization" value="True"/>
      <param name="enable_landmarks_view" value="True"/>
      <param name="enable_observations_view" value="True"/>
      <param name="camera_optical_frames" value="$(var camera_optical_frames)"/>
      <param name="base_frame" value="$(var base_frame)"/>
      <!-- Direct NITROS connection to ZED camera topics for zero-copy GPU transfer -->
      <remap from="/visual_slam/image_0" to="/zedxm/zed_node/left/gray/rect/image"/>
      <remap from="/visual_slam/camera_info_0" to="/zedxm/zed_node/left/gray/rect/camera_info"/>
      <remap from="/visual_slam/image_1" to="/zedxm/zed_node/right/gray/rect/image"/>
      <remap from="/visual_slam/camera_info_1" to="/zedxm/zed_node/right/gray/rect/camera_info"/>
    </composable_node>

  </node_container>

  <!-- RViz visualization -->
  <node pkg="rviz2" exec="rviz2" name="rviz2" if="$(var start_rviz)"
        args="-d $(find-pkg-share slam_launch)/rviz/isaac_zedxm.rviz"/>
</launch>
